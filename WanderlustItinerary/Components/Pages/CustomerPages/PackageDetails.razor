@page "/package-details"

@using Microsoft.EntityFrameworkCore
@using WanderlustItinerary.Domain

@inject IDbContextFactory<WanderlustItinerary.Data.WanderlustItineraryContext> DbFactory
@inject NavigationManager Nav

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    primary: "#0EA5E9",
                    secondary: "#F59E0B",
                    "background-light": "#F8FAFC",
                    "background-dark": "#0F172A",
                    "surface-light": "#FFFFFF",
                    "surface-dark": "#1E293B",
                    "text-light": "#334155",
                    "text-dark": "#CBD5E1",
                    "heading-light": "#0F172A",
                    "heading-dark": "#F1F5F9",
                },
                fontFamily: {
                    sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    display: ['"Playfair Display"', 'serif'],
                },
                borderRadius: { DEFAULT: "0.75rem" },
            },
        },
    };
</script>

@if (package is null)
{
    <div class="min-h-screen flex items-center justify-center bg-background-light dark:bg-background-dark">
        <p class="text-text-light dark:text-text-dark text-lg">Loading...</p>
    </div>
}
else
{
    <div class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-sans antialiased transition-colors duration-300 min-h-screen">

        <!-- NAV -->
        <nav class="fixed w-full z-50 top-0 bg-surface-light/80 dark:bg-surface-dark/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex-shrink-0 flex items-center">
                        <span class="font-display font-bold text-2xl text-primary tracking-tight cursor-pointer"
                              @onclick="GoBack">Wanderlust</span>
                    </div>
                    <div class="hidden md:flex space-x-8 items-center">
                        <a class="text-text-light dark:text-text-dark hover:text-primary font-medium transition" href="/">Home</a>
                        <a class="text-primary font-semibold transition" href="/explore">Packages</a>
                        <a class="text-text-light dark:text-text-dark hover:text-primary font-medium transition" href="#">Destinations</a>
                        <a class="text-text-light dark:text-text-dark hover:text-primary font-medium transition" href="#">Blog</a>
                    </div>
                    <div class="hidden md:flex items-center space-x-4">
                        <a class="px-5 py-2.5 rounded-full bg-primary text-white font-medium hover:bg-sky-600 transition shadow-lg shadow-sky-500/30"
                           href="Account/Login">Sign In</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- HERO -->
        <div class="relative pt-20 h-[85vh] w-full overflow-hidden">
            <div class="absolute inset-0">
                <img alt="@package.PackageName"
                     class="w-full h-full object-cover object-center"
                     src="https://lh3.googleusercontent.com/aida-public/AB6AXuBEaJWcUPTEPHGIKu1yqWNZX1WcQU9poN3ONeg3RwDkOnNiKvgfsQtIpKNTlTBdmZMuGC8NzpfHNhiSmT6TMiRKICMtNmHyqVV1kID8Mo-LF0IfiGZZDxD7V0SyfXBy_1UvZu3UeIwJzc6u8h23OppgGWP8qmdHbNvadjgYKq_xPMr6xLeymdHfcVCISF8mCwx54BKz-xCVhb5qAaKcLpaJkhFOcMBdJVt5Y-Ty_7bj0IfOkXiWF8peP8EENZrQJNV4WQpS6IUDdbA" />
                <div class="absolute inset-0 bg-gradient-to-t from-background-dark/90 via-background-dark/40 to-transparent"></div>
            </div>

            <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex flex-col justify-end pb-20">
                <div class="max-w-3xl">
                    <div class="flex items-center space-x-2 text-white/90 mb-4 font-medium tracking-wide uppercase text-sm">
                        <span class="bg-primary px-3 py-1 rounded text-white text-xs font-bold">Featured</span>
                        <span>Package</span>
                    </div>

                    <h1 class="text-5xl md:text-7xl font-display font-bold text-white mb-6 leading-tight">
                        @package.PackageName
                    </h1>

                    <div class="flex flex-col sm:flex-row gap-6 text-white/90 text-lg">
                        <div class="flex items-center gap-2">
                            <span class="font-bold">4.9</span>
                            <span class="text-gray-300">(128 Reviews)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span>Flexible dates</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span>Curated experience</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- MAIN -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

                <!-- LEFT -->
                <div class="lg:col-span-2 space-y-16">
                    <section>
                        <h2 class="text-3xl font-display font-bold text-heading-light dark:text-heading-dark mb-6">Experience the Package</h2>
                        <div class="prose prose-lg dark:prose-invert text-text-light dark:text-text-dark">
                            <p>@package.Description</p>
                        </div>
                    </section>
                </div>

                <!-- RIGHT (Booking Card) -->
                <div class="lg:col-span-1">
                    <div class="sticky top-24">
                        <div class="bg-surface-light dark:bg-surface-dark rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden">
                            <div class="p-6">
                                <div class="flex justify-between items-end mb-6">
                                    <div>
                                        <span class="text-sm text-gray-500 dark:text-gray-400">Starting from</span>
                                        <div class="flex items-baseline gap-1">
                                            <span class="text-3xl font-bold text-heading-light dark:text-heading-dark">
                                                @package.Price.ToString("C0")
                                            </span>
                                            <span class="text-sm text-gray-500 dark:text-gray-400">/ person</span>
                                        </div>
                                    </div>
                                </div>

                                <hr class="border-gray-200 dark:border-gray-700 mb-6" />

                                <!-- ✅ IMPORTANT: Use <a> link so it ALWAYS navigates -->
                                <a href="/bookings/create?packageId=@Id"
                                   class="w-full inline-flex justify-center items-center bg-primary hover:bg-sky-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-sky-500/40 transition transform hover:-translate-y-0.5">
                                    Book Now
                                </a>

                                <div class="mt-4">
                                    <button type="button"
                                            class="w-full bg-transparent border border-gray-300 dark:border-gray-600 text-text-light dark:text-text-dark font-semibold py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center justify-center gap-2">
                                        Ask a Question
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
}

@code {
    private Package? package;

    // URL will be: /package-details?id=1
    [SupplyParameterFromQuery]
    public int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        package = await context.Package.FirstOrDefaultAsync(p => p.Id == Id);

        if (package is null)
            Nav.NavigateTo("/explore");
    }

    private void GoBack() => Nav.NavigateTo("/explore");
}


